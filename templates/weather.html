<script>
    var sug_token = '0e16cee31b2f66a930741dcb0890816f4f9ecf15';
</script>

<script>
    /* Service variables */
    var globallat = null;
    var globallon = null;
    var globalplace = '';
    var weatherplace = '';
    var friendsplace = '';
    var statplace = '';
    var activetab = 'weather';
    var weathertab = '';
    var friendstab = '';
    var alarmstab = '';
    var stattab = '';
    var temp = [];
    var tempday = [];
    var tempnight = [];
    var humidity = [];
    var pressure = [];
    var selectedchart = '';
    var selectedstreem = '';
    var currenttemp = [];
    var currentfeeltemp = [];
    var currenthum = [];
    var currentpres = [];
    var forecasttemp = [];
    var nextforecasttemp = [];
    var forecastfeeltemp = [];
    var nextforecastfeeltemp = [];
    var suggestions = [];
    var fetchweatherdata = null;
    var fetchaddinfodata = null;
    var fetchforecastdata = null;
    var fetchsecondforecastdata = null;
    var fetchforecasttemp = null;
    var fetchstat = null;
    var currentweather = [];
    var chartloaded = false;
    /* Ui */
    function hidepopup(geo = 'on') {
        if (geo == 'on') {
            allowgeo();
        }
        document.querySelector('.popup_placeholder').style.display = 'none';
        document.querySelector('.container').style.display = '';
        document.querySelector('.content').style.display = '';
        document.querySelector('.detail').style.display = '';
    }
    /* Geolocation */
    function allowgeo() {
        var options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0
        };
        function success(pos) {
            var crd = pos.coords;
            globallon = crd.latitude;
            globallat = crd.longitude;
            globalplace = 'Based on geolocation from GPS';
        }
        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}`);
            document.querySelector('.detail').style.margin = '';
            document.querySelector('.popup_placeholder').style.display = '';
            document.querySelector('.container').style.display = 'none';
            document.querySelector('.detail').style.display = 'none';
            document.querySelector('.content').style.display = 'none';
            inner = `
                <div class="popup">
                    <h3>Somethink went wrong...</h3>
                    <p>It seems that your device do not have GPS or you prohibit using GPS for this app.</p>
                    <button onclick="hidepopup('off')">OK</button>
                </div>
            `;
            document.querySelector('.popup_placeholder').innerHTML = inner;
        }
        navigator.geolocation.getCurrentPosition(success, error, options);
    }
    function writegeoloc(elem) {
        fetchweatherdata = null;
        fetchaddinfodata = null;
        fetchforecastdata = null;
        fetchsecondforecastdata = null;
        fetchforecasttemp = null;

        fetchstat = null;
        
        globallat = elem.id.split(',')[0];
        globallon = elem.id.split(',')[1];
        globalplace = elem.innerText;
        if (globallat & globallon) {

            weather(globallat, globallon, globalplace);
        }
    }
    function bygeoloc(type) {
        allowgeo();
        if (type =='weather') {
            fetchweatherdata = null;
            fetchaddinfodata = null;
            fetchforecastdata = null;
            fetchsecondforecastdata = null;
            fetchforecasttemp = null;

            weather(globallat, globallon, globalplace);
        }
    }
    /* Address query DADATA API */
    function query(input, type) {
        var url = 'https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address';
        var token = sug_token;
        var query = String(input);
        var options = {
            method: 'POST',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'Authorization': 'Token ' + token
            },
            body: JSON.stringify({query: query})
        };
        if (input.length > 2) {
            fetch(url, options)
                .then(response => response.text())
                .then(result => suggestions = JSON.parse(result).suggestions)
                .catch(error => console.log('error', error));
            var inner = `
                <div class='loader_placeholder'>
                    <div class='lds-ellipsis loader'><div></div><div></div><div></div><div></div></div>
                </div>
            `;
            if (suggestions.length > 0) {
                inner = '';
            }
            if (type == 'weather') {
                suggestions.forEach(function(item) {
                    if (item.data.geo_lat & item.data.geo_lon) {
                        inner += `<p id='${item.data.geo_lon},${item.data.geo_lat}' onclick="writegeoloc(this)">${item.value}</p>`;
                    }
                });
            }
            document.querySelector('.suggestions').style.display = 'block';
            document.querySelector('.suggestions').innerHTML = inner;
        }
        if (input.length < 4) {
            suggestions = [];
            document.querySelector('.suggestions').innerHTML = '';
            document.querySelector('.suggestions').style.display = 'none';
        }
    }
    /* Weather request OWM API */
    function weatherrequest(lat, lon, mode, time = '') {
        event.preventDefault();
        if (lat & lon) {
            if (!fetchweatherdata) {
                        fetchweatherdata = weather_json;
                        currentweather = JSON.stringify(weather_json);
                        var inner = `
                            <div class="meteoinfo leftblock">
                                <h3 class="title">Today</h3>
                                <p onclick="weather(null, null)">${JSON.parse(currentweather).weather[0].description}</p>
                                <p onclick="addinfo('temp')">${'Real temperature ' + JSON.parse(currentweather).main.temp + ' °C'}</p>
                                <p onclick="addinfo('feeltemp')">${'Feels like ' + JSON.parse(currentweather).main.feels_like + ' °C'}</p>
                                <p onclick="addinfo('hum')">${'Humidity ' + JSON.parse(currentweather).main.humidity + ' %'}</p>
                                <p onclick="addinfo('pres')">${'Atmosphere pressure ' + JSON.parse(currentweather).main.pressure + ' mmHg'}</p>
                            </div>
                        `;
                        document.querySelector('.weatherinfo').innerHTML = inner;
                        document.querySelector('.weatherinfo').innerHTML += `
                            <div class="meteoinfo rightblock">
                            <iframe
                                id="map"
                                width="100%"
                                height="100%"
                                frameborder="0"
                                scrolling="no"
                                src="https://www.openstreetmap.org/export/embed.html?bbox=${Number(lat) - 0.015},${Number(lon) - 0.015},${Number(lat) + 0.015},${Number(lon) + 0.015}&amp;layer=mapquest&amp;marker=${lon},${lat}">
                            </iframe>
                        `;
                        weathertab = document.querySelector('.content').innerHTML;
            }
            else {
                
                currentweather = JSON.stringify(fetchweatherdata);
                var inner = `
                    <div class="meteoinfo leftblock">
                        <h3 class="title">Сегодня</h3>
                        <p onclick="weather(null, null)">${JSON.parse(currentweather).weather[0].description}</p>
                        <p onclick="addinfo('temp')">${'Real temperature ' + JSON.parse(currentweather).main.temp + ' °C'}</p>
                        <p onclick="addinfo('feeltemp')">${'Feels like ' + JSON.parse(currentweather).main.feels_like + ' °C'}</p>
                        <p onclick="addinfo('hum')">${'Humidity ' + JSON.parse(currentweather).main.humidity + ' %'}</p>
                        <p onclick="addinfo('pres')">${'Atmosphere pressure ' + JSON.parse(currentweather).main.pressure + ' mmHg'}</p>
                    </div>
                `;
                document.querySelector('.weatherinfo').innerHTML = inner;
                document.querySelector('.weatherinfo').innerHTML += `
                    <div class="meteoinfo rightblock">
                    <iframe
                        width="100%"
                        height="100%"
                        frameborder="0"
                        scrolling="no"
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${Number(lat) - 0.015},${Number(lon) - 0.015},${Number(lat) + 0.015},${Number(lon) + 0.015}&amp;layer=mapquest&amp;marker=${lon},${lat}">
                    </iframe>
                `;
                weathertab = document.querySelector('.content').innerHTML;
            }
        }
    }
    /* Weather tab forecast OWM API */
    function forecast(days, exclude = 'current,minutely,hourly,alerts') {
        event.preventDefault();
        if (days == 2) {
            forecasttemp = [];
            forecastfeeltemp = [];
            nextforecasttemp = [];
            nextforecastfeeltemp = [];
            document.querySelector('.detail').innerHTML = '';
            if (globallat & globallon) {
                if (!fetchsecondforecastdata) {
                    fetchsecondforecastdata = forecast_json;
                    forecasttemp.push(forecast_json.daily[1].temp.day);
                    forecasttemp.push(forecast_json.daily[1].temp.eve);
                    forecasttemp.push(forecast_json.daily[1].temp.night);
                    forecastfeeltemp.push(forecast_json.daily[1].feels_like.day);
                    forecastfeeltemp.push(forecast_json.daily[1].feels_like.eve);
                    forecastfeeltemp.push(forecast_json.daily[1].feels_like.night);
                    nextforecasttemp.push(forecast_json.daily[2].temp.day);
                    nextforecasttemp.push(forecast_json.daily[2].temp.eve);
                    nextforecasttemp.push(forecast_json.daily[2].temp.night);
                    nextforecastfeeltemp.push(forecast_json.daily[2].feels_like.day);
                    nextforecastfeeltemp.push(forecast_json.daily[2].feels_like.eve);
                    nextforecastfeeltemp.push(forecast_json.daily[2].feels_like.night);
                }
                else {  
                    forecasttemp.push(fetchsecondforecastdata.daily[1].temp.day);
                    forecasttemp.push(fetchsecondforecastdata.daily[1].temp.eve);
                    forecasttemp.push(fetchsecondforecastdata.daily[1].temp.night);
                    forecastfeeltemp.push(fetchsecondforecastdata.daily[1].feels_like.day);
                    forecastfeeltemp.push(fetchsecondforecastdata.daily[1].feels_like.eve);
                    forecastfeeltemp.push(fetchsecondforecastdata.daily[1].feels_like.night);
                    nextforecasttemp.push(fetchsecondforecastdata.daily[2].temp.day);
                    nextforecasttemp.push(fetchsecondforecastdata.daily[2].temp.eve);
                    nextforecasttemp.push(fetchsecondforecastdata.daily[2].temp.night);
                    nextforecastfeeltemp.push(fetchsecondforecastdata.daily[2].feels_like.day);
                    nextforecastfeeltemp.push(fetchsecondforecastdata.daily[2].feels_like.eve);
                    nextforecastfeeltemp.push(fetchsecondforecastdata.daily[2].feels_like.night);
                }
            }
        }
        else {
            document.querySelector('.detail').innerHTML = '';
        }
        if (globallat & globallon) {
            if (!fetchforecastdata) {
                        fetchforecastdata = forecast_json;
                        if (days == 2) {
                            inner = `
                                <div class="weatherinfo">
                                    <div class="meteoinfo leftblock">
                                        <h3 class="title">Tomorrow</h3>
                                        <p onclick="addinfo(null, 'right', true)">${forecast_json.daily[1].weather[0].description}</p>
                                        <p onclick="addinfo('temp')">${'Temperature ' + forecast_json.daily[1].temp.day + ' °C'}</p>
                                        <p onclick="addinfo('feeltemp')">${'Feels like ' + forecast_json.daily[1].feels_like.day + ' °C'}</p>
                                        <p onclick="addinfo('hum')">${'Humidity ' + forecast_json.daily[1].humidity + ' %'}</p>
                                        <p onclick="addinfo('pres')">${'Atmospheric pressure ' + forecast_json.daily[1].pressure + ' mmHg'}</p>
                                    </div>
                                    <div class="meteoinfo rightblock">
                                        <h3 class="title">The day after tomorrow</h3>
                                        <p onclick="addinfo(null, 'left', true)">${forecast_json.daily[2].weather[0].description}</p>
                                        <p onclick="addinfo('temp', 'left')">${'Temperature ' + forecast_json.daily[2].temp.day + ' °C'}</p>
                                        <p onclick="addinfo('feeltemp', 'left')">${'Feels like ' + forecast_json.daily[2].feels_like.day + ' °C'}</p>
                                        <p onclick="addinfo('hum', 'left')">${'Humidity ' + forecast_json.daily[2].humidity + ' %'}</p>
                                        <p onclick="addinfo('pres', 'left')">${'Atmospheric pressure ' + forecast_json.daily[2].pressure + ' mmHg'}</p>
                                    </div>
                                </div>
                                <form>
                                    <button onclick="weather(null, null)">Forecast for today</button>
                                    <button onclick="forecast(2)">2-day forecast</button>
                                    <button onclick="forecast(6)">6-day forecast</button>
                                </form>
                            `;
                            document.querySelector('.content').innerHTML = inner;
                        }
                        if (days == 6) {
                            inner = `
                                <div class="weatherinfo">
                                    <div class="meteoinfo">
                                        <h3 class="title">Tomorrow</h3>
                                        <p onclick="forecastinfo(1)">
                                        ${forecast_json.daily[1].weather[0].description + ' ' + forecast_json.daily[1].temp.day + ' °C'}
                                        </p>
                                    </div>
                                    <div class="meteoinfo">
                                        <h3 class="title">The day after tomorrow</h3>
                                        <p onclick="forecastinfo(2)">
                                        ${forecast_json.daily[2].weather[0].description + ' ' + forecast_json.daily[2].temp.day + ' °C'}
                                        </p>
                                    </div>
                                    <div class="meteoinfo">
                                        <h3 class="title">After 3 days</h3>
                                        <p onclick="forecastinfo(3)">
                                        ${forecast_json.daily[3].weather[0].description + ' ' + forecast_json.daily[3].temp.day + ' °C'}
                                        </p>
                                    </div>
                                    <div class="meteoinfo">
                                        <h3 class="title">After 4 days</h3>
                                        <p onclick="forecastinfo(4)">
                                        ${forecast_json.daily[4].weather[0].description + ' ' + forecast_json.daily[4].temp.day + ' °C'}
                                        </p>
                                    </div>
                                    <div class="meteoinfo">
                                        <h3 class="title">After 5 days</h3>
                                        <p onclick="forecastinfo(5)">
                                        ${forecast_json.daily[5].weather[0].description + ' ' + forecast_json.daily[5].temp.day + ' °C'}
                                        </p>
                                    </div>
                                    <div class="meteoinfo">
                                        <h3 class="title">After 6 days</h3>
                                        <p onclick="forecastinfo(6)">
                                        ${forecast_json.daily[6].weather[0].description + ' ' + forecast_json.daily[6].temp.day + ' °C'}
                                        </p>
                                    </div>
                                </div>
                                <form>
                                    <button onclick="weather(null, null)">Forecast for today</button>
                                    <button onclick="forecast(2)">2-day forecast</button>
                                    <button onclick="forecast(6)">6-day forecast</button>
                                </form>
                            `;
                            document.querySelector('.content').innerHTML = inner;
                        }
            }
            else {
                if (days == 2) {
                    inner = `
                        <div class="weatherinfo">
                            <div class="meteoinfo leftblock">
                                <h3 class="title">Tomorrow</h3>
                                <p onclick="addinfo(null, 'right', true)">${fetchforecastdata.daily[1].weather[0].description}</p>
                                <p onclick="addinfo('temp')">${'Temperature ' + fetchforecastdata.daily[1].temp.day + ' °C'}</p>
                                <p onclick="addinfo('feeltemp')">${'Feels like ' + fetchforecastdata.daily[1].feels_like.day + ' °C'}</p>
                                <p onclick="addinfo('hum')">${'Humidity ' + fetchforecastdata.daily[1].humidity + ' %'}</p>
                                <p onclick="addinfo('pres')">${'Atmospheric pressure ' + fetchforecastdata.daily[1].pressure + ' mmHg'}</p>
                            </div>
                            <div class="meteoinfo rightblock">
                                <h3 class="title">The day after tomorrow</h3>
                                <p onclick="addinfo(null, 'left', true)">${fetchforecastdata.daily[2].weather[0].description}</p>
                                <p onclick="addinfo('temp', 'left')">${'Temperature ' + fetchforecastdata.daily[2].temp.day + ' °C'}</p>
                                <p onclick="addinfo('feeltemp', 'left')">${'Feels like ' + fetchforecastdata.daily[2].feels_like.day + ' °C'}</p>
                                <p onclick="addinfo('hum', 'left')">${'Humidity ' + fetchforecastdata.daily[2].humidity + ' %'}</p>
                                <p onclick="addinfo('pres', 'left')">${'Atmospheric pressure ' + fetchforecastdata.daily[2].pressure + ' mmHg'}</p>
                            </div>
                        </div>
                        <form>
                            <button onclick="weather(null, null)">Forecast for today</button>
                            <button onclick="forecast(2)">2-day forecast</button>
                            <button onclick="forecast(6)">6-day forecast</button>
                        </form>
                    `;
                    document.querySelector('.content').innerHTML = inner;
                }
                if (days == 6) {
                    inner = `
                        <div class="weatherinfo">
                            <div class="meteoinfo">
                                <h3 class="title">Tomorrow</h3>
                                <p onclick="forecastinfo(1)">
                                ${fetchforecastdata.daily[1].weather[0].description + ' ' + fetchforecastdata.daily[1].temp.day + ' °C'}
                                </p>
                            </div>
                            <div class="meteoinfo">
                                <h3 class="title">The day after tomorrow</h3>
                                <p onclick="forecastinfo(2)">
                                ${fetchforecastdata.daily[2].weather[0].description + ' ' + fetchforecastdata.daily[2].temp.day + ' °C'}
                                </p>
                            </div>
                            <div class="meteoinfo">
                                <h3 class="title">After 3 days</h3>
                                <p onclick="forecastinfo(3)">
                                ${fetchforecastdata.daily[3].weather[0].description + ' ' + fetchforecastdata.daily[3].temp.day + ' °C'}
                                </p>
                            </div>
                            <div class="meteoinfo">
                                <h3 class="title">After 4 days</h3>
                                <p onclick="forecastinfo(4)">
                                ${fetchforecastdata.daily[4].weather[0].description + ' ' + fetchforecastdata.daily[4].temp.day + ' °C'}
                                </p>
                            </div>
                            <div class="meteoinfo">
                                <h3 class="title">After 5 days</h3>
                                <p onclick="forecastinfo(5)">
                                ${fetchforecastdata.daily[5].weather[0].description + ' ' + fetchforecastdata.daily[5].temp.day + ' °C'}
                                </p>
                            </div>
                            <div class="meteoinfo">
                                <h3 class="title">After 6 days</h3>
                                <p onclick="forecastinfo(6)">
                                ${fetchforecastdata.daily[6].weather[0].description + ' ' + fetchforecastdata.daily[6].temp.day + ' °C'}
                                </p>
                            </div>
                        </div>
                        <form>
                            <button onclick="weather(null, null)">Forecast for today</button>
                            <button onclick="forecast(2)">2-day forecast</button>
                            <button onclick="forecast(6)">6-day forecast</button>
                        </form>
                    `;
                    document.querySelector('.content').innerHTML = inner;
                }
            }
        }
    }
    /* Weather tab forecast map & charts OWM API & OSM iframe */
    function addinfo(type = null, position = 'right', map = false, day = 0) {
        if (map) {
            if (globallat & globallon) {
                var divposition = ''
                if (position == 'right') {
                    divposition = 'left';
                }
                else if(position == 'left') {
                    divposition = 'right';
                }
                document.querySelector('.' + position + 'block').innerHTML = `
                    <iframe
                        id="map"
                        width="100%"
                        height="100%"
                        frameborder="0"
                        scrolling="no"
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${Number(globallat) - 0.015},${Number(globallon) - 0.015},${Number(globallat) + 0.015},${Number(globallon) + 0.015}&amp;layer=mapquest&amp;marker=${globallon},${globallat}">
                    </iframe>
                `;
            }
        }
        else {
            if (globallat & globallon) {
                if (!fetchaddinfodata) {
                            fetchaddinfodata = forecast_json;
                            var array = forecast_json.hourly;
                            currenttemp = [];
                            currentfeeltemp = [];
                            currenthum = [];
                            currentpres = [];
                            for (let index = 0; index < array.length; index = index + 4) {
                                currenttemp.push(array[index].temp);
                                currentfeeltemp.push(array[index].feels_like);
                                currenthum.push(array[index].humidity);
                                currentpres.push(array[index].pressure);
                            }
                }
                else {
                    var array = fetchaddinfodata.hourly;
                            currenttemp = [];
                            currentfeeltemp = [];
                            currenthum = [];
                            currentpres = [];
                            for (let index = 0; index < array.length; index = index + 4) {
                                currenttemp.push(array[index].temp);
                                currentfeeltemp.push(array[index].feels_like);
                                currenthum.push(array[index].humidity);
                                currentpres.push(array[index].pressure);
                            }
                }
            }
            if (type == 'temp') {
                document.querySelector('.' + position + 'block').innerHTML = `
                    <h3 class="title">Temperature chart</h3>
                    <canvas id="myChart"></canvas>
                `;
                var ctx = document.getElementById('myChart').getContext('2d');
                var chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: [0,2,4,6,8,10,12,14,16,18,20,22],
                        datasets: [{
                            label: 'Temperature during the day (°C)',
                            borderColor: '#CC1B41',
                            data: currenttemp
                        }]
                        },
                        options: {
                            layout: {
                                padding: {
                                left: 5,
                                right: 15,
                                top: 0,
                                bottom: 5
                            }
                        }
                    }
                });
            }
            if (type == 'feeltemp') {
                document.querySelector('.' + position + 'block').innerHTML = `
                    <h3 class="title">Temperature chart (feels like)</h3>
                    <canvas id="myChart"></canvas>
                `;
                var ctx = document.getElementById('myChart').getContext('2d');
                var chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: [0,2,4,6,8,10,12,14,16,18,20,22],
                        datasets: [{
                            label: 'Feels like (°C)',
                            borderColor: '#13926B',
                            data: currentfeeltemp
                        }]
                        },
                        options: {
                            layout: {
                                padding: {
                                left: 5,
                                right: 15,
                                top: 0,
                                bottom: 5
                            }
                        }
                    }
                });
            }
            if (type == 'hum') {
                document.querySelector('.' + position + 'block').innerHTML = `
                    <h3 class="title">Humidity Chart</h3>
                    <canvas id="myChart"></canvas>
                `;
                var ctx = document.getElementById('myChart').getContext('2d');
                var chart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: [0,2,4,6,8,10,12,14,16,18,20,22],
                        datasets: [{
                            label: 'Humidity during the day (%)',
                            borderColor: '#CC1B41',
                            data: currenthum
                        }]
                        },
                        options: {
                            layout: {
                                padding: {
                                left: 5,
                                right: 15,
                                top: 0,
                                bottom: 5
                            }
                        }
                    }
                });
            }
            if (type == 'pres') {
                document.querySelector('.' + position + 'block').innerHTML = `
                    <h3 class="title">Atmospheric pressure graph</h3>
                    <canvas id="myChart"></canvas>
                `;
            var ctx = document.getElementById('myChart').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: [0,2,4,6,8,10,12,14,16,18,20,22],
                    datasets: [{
                        label: 'Atmospheric pressure (mmHg)',
                        borderColor: '#13926B',
                        data: currentpres
                    }]
                    },
                    options: {
                        layout: {
                            padding: {
                            left: 5,
                            right: 15,
                            top: 0,
                            bottom: 5
                        }
                    }
                }
            });
            }
        }
    }
    /* Weather tab forecast temp charts OWM API */
    function forecastinfo(day = 0) {
        document.querySelector('.detail').innerHTML = '';
        if (globallat & globallon) {
            if (!fetchforecasttemp) {
                fetchforecasttemp = forecast_json;
                forecasttemp = [];
                forecastfeeltemp = [];
                forecasttemp.push(forecast_json.daily[day].temp.day);
                forecasttemp.push(forecast_json.daily[day].temp.eve);
                forecasttemp.push(forecast_json.daily[day].temp.night);
                forecastfeeltemp.push(forecast_json.daily[day].feels_like.day);
                forecastfeeltemp.push(forecast_json.daily[day].feels_like.eve);
                forecastfeeltemp.push(forecast_json.daily[day].feels_like.night);
            }
            else {
                forecasttemp = [];
                forecastfeeltemp = [];
                forecasttemp.push(fetchforecasttemp.daily[day].temp.day);
                forecasttemp.push(fetchforecasttemp.daily[day].temp.eve);
                forecasttemp.push(fetchforecasttemp.daily[day].temp.night);
                forecastfeeltemp.push(fetchforecasttemp.daily[day].feels_like.day);
                forecastfeeltemp.push(fetchforecasttemp.daily[day].feels_like.eve);
                forecastfeeltemp.push(fetchforecasttemp.daily[day].feels_like.night);
            }
        }
        var key = [' for today', ' for tomorrow', ' the day after tomorrow', ' after 3 days', ' after 4 days', ' after 5 days', ' after 6 days'];
        if (forecasttemp.length > 0) {
            document.querySelector('.detail').innerHTML = `
                <h3 class="title">Weather forecast${key[day]}</h3>
                <canvas style="margin-bottom: 8px;" id="myChart"></canvas>
            `;
            var ctx = document.getElementById('myChart').getContext('2d');
            var chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Day', 'Evening', 'Night'],
                    datasets: [{
                        label: 'Temperature (°C)',
                        borderColor: '#13926B',
                        backgroundColor: '#13926B',
                        data: forecasttemp
                    },{
                        label: 'Feels like (°C)',
                        borderColor: '#CC1B41',
                        backgroundColor: '#CC1B41',
                        data: forecastfeeltemp
                    }]
                },
                options: {
                    layout: {
                        padding: {
                            left: 5,
                            right: 15,
                            top: 5,
                            bottom: 5
                        }
                    }
                }
            });
            function intoview() {
                document.querySelector('.detail').scrollIntoView({block: "center", inline: "center", behavior: "smooth"});
            }
            setTimeout(intoview, 250);
        }
    }
    /* Main function */
    function weather(lat, lon, place = null) {
        event.preventDefault();
        document.querySelector('.detail').innerHTML = '';
        document.querySelector('.container').innerHTML = `
            <br>
            <form>
                <input class="input" type="text" placeholder="Enter the name of the locality" maxlength="30" oninput="query(this.value, 'weather')">
                <button onclick="bygeoloc('weather')">Weather by GPS</button>
                <div class="suggestions"></div>
                <div class="geoloc"></div>
            </form>
        `;
        document.querySelector('.content').innerHTML = `
            <div class="weatherinfo"></div>
            <form>
                <button onclick="weather(null, null)">Forecast for today</button>
                <button onclick="forecast(2)">2-day forecast</button>
                <button onclick="forecast(6)">6-day forecast</button>
            </form>
        `;
        if (place) {
            document.querySelector('.input').value = place;
            weatherplace = place;
        }
        if (lat && lon) {
            alert('Websocket not implemented in github pages, cant apply serverside request, test data loaded')
            //
            //
            // websocket -> serverside owm api recuest -> get data (weather_json & forecast_json)
            //
            //
            weatherrequest (lat, lon, 'json');
        }
        if (lat == null || lon == null) {
            document.querySelector('.content').innerHTML = '';
            if (weathertab.length > 1) {
                document.querySelector('.content').innerHTML = weathertab;
                document.querySelector('.input').value = weatherplace;
            }
        }
        document.querySelector('.suggestions').style.display = 'none';
        addinfo();
    }
    /* Init */
    window.onload = function() {
        let url = window.location.href
        document.getElementById('facebook').href = 'https://facebook.com/sharer/sharer.php?u=' + url
        document.getElementById('vkontakte').href = 'https://vk.com/share.php?url=' + url
        document.getElementById('whatsapp').href = 'whatsapp://send?text=' + url
        document.getElementById('telegram').href = 'https://t.me/share/url?url=' + url
        document.querySelector('.container').style.display = 'none';
        document.querySelector('.content').style.display = 'none';
        document.querySelector('.detail').style.display = 'none';
        weather(null, null);
    };
</script>

<style>
    * {
        font-family: sans-serif;
    }
    p, h3 {
        filter: drop-shadow(0 0 2px #aaa);
        color: #333;
    }
    body {
        margin: 0;
        padding: 0;
        background-color: #fff;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
        justify-content: start;
        min-height: 100vh;
    }
    .back {
        padding:0;
        margin:0;
        position: fixed;
        top: 0;
        z-index: -100;
    }
    div.btnbg {
        position:fixed;
        left:0;
        top:0;
    }
    form {
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        flex-wrap: wrap;
        padding: 16px 0;
    }
    form > input {
        width: 63%;
        height: 50px;
        min-width: 150px;
        padding: 0 15px;
    }
    form > button {
        padding: 0;
        width: 30%;
        height: 50px;
        min-width: 75px;
    }
    button {
        background-color: #6699CC;
        color: #fff;
        border-style: none;
        cursor: pointer;
        box-shadow: 0 0 8px #6699CC;
        font-weight: 900;
        border-radius: 4px;
    }
    button:hover {
        color: #6699CC;
        background-color: #fff;
    }
    button:active, button:focus {
        outline: none;
        box-shadow: none;
    }
    input {
        padding: 0 20px;
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: #3331;
        border: none;
        border-radius: 0px;
        border-bottom: 2px solid #333;
        box-shadow:0 0 8px #ccc;
    }
    input:focus {    
        outline: none;
        border-color: #6699CC;
        box-shadow: 0 0 8px #6699CC;
    }
    .popup_placeholder {
        background-color: #fff;
        top: 0;
        position: fixed;
        height: 100vh;
        width: 100vw;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .popup {
        background-color: #fff;
        border-radius: 4px;
        box-shadow: 0 0 8px #ccc;
        padding: 25px;
        max-width: 256px;
        text-align: center;
        margin: 0 auto;
    }
    .popup > button {
        width: 150px;
        height: 48px;
    }
    .container {
        background-color: #fff;
        margin: 0 auto;
        width: 100%;
        max-width: 900px;
    }
    .content {
        background-color: #fff;
        margin: 0 auto;
        width: 100%;
        max-width: 900px;
    }
    .detail{
        margin: 0 auto;
        max-width: 900px;
        width: 100%;
    }
    .title {
        text-align: start;
        padding: 0 24px;
        overflow: hidden;
        margin: 0;
    }
    .suggestions {
        background-color: #fff;
        width: 63%;
        margin: 0;
        padding: 8px 0;
        box-shadow: 0 0 8px #ccc;
        z-index: 999;
    }
    .geoloc {
        width: 30%;
    }
    .suggestions > p {
        padding: 7px 15px;
        margin: 0;
    }
    .suggestions > p:hover {
        background-color: #eee;
        cursor: pointer;
    }
    .nomap {
        width: 100%;
        max-height: 350px;
    }
    .weatherinfo {
        text-align: center;
        font-size: 18px;
        display: flex;
        flex-direction: row;
        text-align: start;
        flex-wrap: wrap;
    }
    .meteoinfo {
        width: 100%;
        overflow: hidden;
        margin-bottom: 16px;
    }
    .meteoinfo > p {
        padding: 8px 32px;
        margin: 0;
    }
    .meteoinfo > p:hover {
        background-color: #eee;
        cursor: pointer;
    }
    .meteoinfo > p:active {
        background-color: #fff;
        cursor: pointer;
    }
    #map {
        height: 256px;
    }
    #myChart {
        margin: 20px 0 30px 0;
    }
    /* Loader animation */
    .loader_placeholder{
        display: flex;
        justify-content: center;
    }
    .lds-ellipsis {
        display: inline-block;
        position: relative;
        width: 80px;
        height: 14px;
    }
    .lds-ellipsis div {
        position: absolute;
        top: 3px;
        width: 13px;
        height: 13px;
        border-radius: 50%;
        background: #333;
        animation-timing-function: cubic-bezier(0, 1, 1, 0);
    }
    .lds-ellipsis div:nth-child(1) {
        left: 8px;
        animation: lds-ellipsis1 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(2) {
        left: 8px;
        animation: lds-ellipsis2 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(3) {
        left: 32px;
        animation: lds-ellipsis2 0.6s infinite;
    }
    .lds-ellipsis div:nth-child(4) {
        left: 56px;
        animation: lds-ellipsis3 0.6s infinite;
    }
    @keyframes lds-ellipsis1 {
        0% {
        transform: scale(0);
        }
        100% {
        transform: scale(1);
        }
    }
    @keyframes lds-ellipsis3 {
        0% {
        transform: scale(1);
        }
        100% {
        transform: scale(0);
        }
    }
    @keyframes lds-ellipsis2 {
        0% {
        transform: translate(0, 0);
        }
        100% {
        transform: translate(24px, 0);
        }
    }
    .share {
        z-index: 999;
        box-shadow: 0 0 16px #ccc;
        display: flex;
        justify-content: center;
        overflow-x: auto;
    }

    .share > a > img {
        margin: 8px;
        opacity: 0.72;
        border-radius: 6px;
    }

    .share > a > img:hover {
        opacity: 1;
    }
</style>

<body>
    <div class="share">
        <!-- Sharingbutton Facebook -->
        <a id="facebook" target="_blank" rel="noopener">
            <img
                height="24px" width="24px" 
                src="../assets/fb.png" alt="sharedmedia"
            >
        </a>
        <!-- Sharingbutton Vkontakte -->
        <a id="vkontakte" target="_blank" rel="noopener">
            <img
                height="24px" width="24px" 
                src="../assets/vk.png" alt="sharedmedia"
            >
        </a>
        <!-- Sharingbutton WhatsApp -->
        <a id="whatsapp" target="_blank" rel="noopener">
            <img
                height="24px" width="24px" 
                src="../assets/wp.png" alt="sharedmedia"
            >
        </a>
        <!-- Sharingbutton Telegram -->
        <a id="telegram" target="_blank" rel="noopener">
            <img
                height="24px" width="24px" 
                src="../assets/tm.png" alt="sharedmedia"
            >
        </a>  
    </div>
    <div class="popup_placeholder">
        <div class="popup">
            <h3>GPS warning</h3>
            <p>
                This app needs GPS to provide weather info based on your location. 
                Please turn on GPS on your device for better expirience.
            </p>
            <button onclick="hidepopup()">OK</button>
        </div>
    </div>
    <div class="container"></div>
    <div class="detail"></div>
    <div class="content"></div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="../app-data/forecast.js"></script>
    <script src="../app-data/weather.js"></script>
</body>